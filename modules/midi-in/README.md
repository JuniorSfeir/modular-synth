# MIDI in module

## Printed circuit boards

### Display board

#### Dimensions

Board width: 101.6mm (4")
Board height: 63.5mm (2.5")

Screw diameter: 3mm

Screw positions from bottom left (X,Y):

  - 5.08mm, 5.08mm
  - 5.08mm, 58.42mm
  - 96.52mm, 58.42mm
  - 96.52mm, 5.08mm

Summarized, the 4 screws are offset 5.08mm (.2") from the sides.

This makes them span a rectangle of 81.28mm x 43.18mm (3.2" x 1.7")

#### Part list

- R1-16: 220 Ohm 1/8W, 5% tolerance resistor
- R17, R18: 10 KOhm 1/8W, 5% tolerance resistor
- T1: BC547C NPN Transistor
- C1: 100 nF ceramic capacitor (can be replaced with electrolytic too)
- D1, D2: TDSG5150 or equivalent Common Anode 7 segment display
- V1, V2: 74595 8-bit shift register
- SV1: Standard .100" pitch pin header, or leave empty to solder wires directly to board


#### Description

The display board houses two 7-segment LED displays, to display the currently selected MIDI channel.

The shift registers on the board keep hold of the digits being displayed, and are fed data by the microcontroller on the main board.

R1-16 are current-limiting resistors for each of the 8 LEDs per display.

The transistor circuit connected to the shift registers' reset pins causes the registers to reset when the circuit is being powered up. The registers' reset pin needs to be held low (0V) in order to reset. On power-up, C1 has no charge. A current will flow "through" C1 and R18 (10K), causing a voltage drop across R18. Having the voltage drop across R18 brings the point connected to the reset pins (junction between R18 and C1) to 0V, resetting the shift registers. Once the capacitor is charged enough, the voltage drop has shifted to be across C1, and the reset pins are back to 5V, meaning the registers are no longer being reset. Normal operation can begin.

[Fun fact: while writing that power-up description I noticed I designed it wrong in the schematic: I'd be shorting VCC to GND through T1, blowing up the transistor. Documenting is good.]


### MIDI In board

#### Dimensions (identical to display board)

Board width: 101.6mm (4")
Board height: 63.5mm (2.5")

Screw diameter: 3mm

Screw positions from bottom left (X,Y):

  - 5.08mm, 5.08mm
  - 5.08mm, 58.42mm
  - 96.52mm, 58.42mm
  - 96.52mm, 5.08mm

Summarized, the 4 screws are offset 5.08mm (.2") from the sides.

This makes them span a rectangle of 81.28mm x 43.18mm (3.2" x 1.7")

#### Part list

- R1: 1 KOhm 1/8W, 5% tolerance resistor
- R2, R3, R5: 220 Ohm 1/8W, 5% tolerance resistor
- R4, R8-12: 10 KOhm 1/8W, 5% tolerance resistor
- D1: 1N4148 Diode
- C1-6: 100 nF ceramic capacitor
- OK1: 6N137 optocoupler (Should be able to drop in 6N138 or 6N139 without further changes)
- IC1: LM358 Dual single-supply opamp (even though we're only using one)
- SV1, SV2: Standard .100" 12-pin female pin header
- X1, X6: .200" pitch connector, or leave empty to solder wires directly to board
- X2-4, JP1: .100" pitch connector, or leave empty to solder wires directly to board

#### Description

The MIDI in board uses an opto-coupler (OK1) to electrically isolate the MIDI input signal from our circuit. Its input is buffered through an opamp (IC1) and connected back to the MIDI Thru connector, to allow daisy-chaining.

The circuit houses an Arduino Pro Micro, plugged into female pin headers SV1 and SV2. The filtered MIDI signal (serial data) is fed into the RX pin of the Arduino. The Arduino is programmed to only listen to one of the available MIDI channels, and the selected channel is to be displayed on 7-segment displays. The software listens for MIDI status messages, and updates 7 outputs
based on this data.

The 7 segment displays are on the display board where shift registers drive them. The serial data is clocked through by the Arduino, and is hooked up through connector X5.

There is an input for a momentary push button (push to make contact), which lets you change the MIDI channel listened for. Pushing the button shorts the relevant pin to ground, where it's normally high at 5V.

The main outputs are the logic "gate" and "trigger", and the analog "FreqCV". Gate is high as long as at least one note is pressed. Trigger pulses high for 1ms whenever a new note is pressed. These are intended to be used by envelope generators later. FreqCV is destined for an analog voltage where a difference of 1V represents a difference of 1 octave in sound frequency. At the output here though, it's still just in the arduino's output range of 0-5V.

Further, there are 4 additional analog outputs, MOD1-4. They also come out as 0-5V from this board.

All the analog outputs on here come from a pulse width modulation (PWM) signal generated by the arduino. A passive low pass filter comprised of a 100nF capacitor and a 10K resistor is connected to each of them, to normalize the PWM to an analog voltage.

All these outputs will be connected to the CV (control voltage) board, where the voltage ranges get scaled to appropriate levels (including fine-tuning through trimpots).